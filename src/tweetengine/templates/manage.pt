<metal:master use-macro="master">

  <metal:title fill-slot="title">${current_account.username} &ndash; Manage Account</metal:title>

  <metal:sidebar fill-slot="sidebar">
    <metal:use metal:use-macro="macros['sidebar-accounts']"  />
  </metal:sidebar>
  
  <metal:body fill-slot="body">
  
    <div class="post">
    
      <p tal:condition="sent" class="notification">Invites sent!</p>

      <h2>Manage Account ${current_account.username}</h2>
  
 
      <h3>Users</h3>
      <form method="POST" action="/${current_account.username}/manage_users">
          <table class="display">
            <thead>
              <tr><th>Delete</th><th>Email</th><th>User</th><th>Admin</th></tr>
            </thead>
            <tbody>
	            <tr tal:repeat="permission acct_permissions">
	              <td class="field">
	                  <input tal:condition="permission.key()==my_key"
	                    type="checkbox" name="delete" 
	                    value="${permission.key().name()}" 
	                    disabled="disabled" />
	                  <input tal:condition="permission.key()!=my_key"
	                    type="checkbox" name="delete" 
	                    value="${permission.key().name()}" />
	              </td>
	              <td>${permission.user.get_username()}</td>
	              <td class="field">
	                  <input type="radio" name="permission.${permission.key().name()}" value="1" 
	                    tal:attributes="checked permission.role==1 and 'checked' or None;
	                                    disabled permission.key()==my_key and 'disabled' or None"/> 
	                    
	               </td>
	              <td class="field">
	                  <input type="radio" name="permission.${permission.key().name()}" value="2" 
	                    tal:attributes="checked permission.role==2 and 'checked' or None;
	                                    disabled permission.key()==my_key and 'disabled' or None"/>
	                     
	              </td>
	                
	            </tr>
	
	            <tr>
	              <td></td>
	              <td><input type="text" name="username" /></td>
	              <td class="field"><input type="radio" name="new_permission" value="1" checked="checked" /></td>
	              <td class="field"><input type="radio" name="new_permission" value="2" /></td>
	            </tr>
	        </tbody>
          </table>
          <input type="submit" value="Update" />
      </form>
    </div>

    <div class="post">
      <h3>Permissions</h3>
      <form method="POST" action="/${current_account.username}/manage">
        <table class="display grid">
          <thead>
            <tr><th></th><th>Anyone</th><th>Users</th><th>Administrators</th></tr>
          </thead>
          <tal:form tal:replace="structure settings_form" />
        </table>
        <input type="submit" value="Update" />
      </form>
    </div>  

    <div class="post">
      <h3>Delete Account ${current_account.username}</h3>
      <form method="POST" action="/${current_account.username}/delete">
        <p>
            <input type="checkbox" name="confirm" value="yes" id="confirm" />
            <label for="confirm">Yes, I'm really, really sure I want to remove this
            twitter account from Tweet Engine</label>
        </p>
        <p>
            <input type="checkbox" name="confirm2" value="yes" id="confirm2" />
            <label for="confirm2">I know this will remove this account for everyone,
            not just me, and that if I re-add it, I will have to invite all my users
            again.</label>
        </p>
        <input type="submit" value="Delete" />
      </form>
    </div>
  </metal:body>
</metal:master>